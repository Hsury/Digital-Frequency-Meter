LIBRARY IEEE;
USE IEEE.STD_LOGIC_1164.ALL;
ENTITY DIVFREQ IS
	GENERIC(STDFREQ : INTEGER:=5E7); --板载晶振频率为50MHz
	PORT(FSTD : IN STD_LOGIC;
	     CLKBUS : OUT STD_LOGIC_VECTOR (7 DOWNTO 0)); --对应10MHz到0.1Hz
END ENTITY DIVFREQ;
ARCHITECTURE behav OF DIVFREQ IS
	SIGNAL COUNTER : INTEGER RANGE 0 TO (STDFREQ*1E-7)-1; --计满0.1Hz时计数器才发生溢出
	SIGNAL COTIME : INTEGER RANGE 0 TO 1E8;
	SIGNAL CO : STD_LOGIC;
BEGIN
	PROCESS (FSTD)
	BEGIN
		IF RISING_EDGE(FSTD) THEN COUNTER<=COUNTER+1; END IF;
	END PROCESS;
	PROCESS (COUNTER)
	BEGIN
		IF COUNTER=(STDFREQ*1E-7)-1 THEN
			CO<='1';
			COUNTER<=0;
		ELSE
			CO<='0';
		END IF;
	END PROCESS;
	PROCESS (CO)
	BEGIN
		IF RISING_EDGE(CO) THEN
			COTIME<=COTIME+1;
		END IF;
	END PROCESS;
	PROCESS (COTIME)
	BEGIN
		CASE COTIME IS
			WHEN 1E0 => CLKBUS<=(7<='1',OTHERS<='0');
			WHEN 1E1 => CLKBUS<=(6<='1',OTHERS<='0');
			WHEN 1E2 => CLKBUS<=(5<='1',OTHERS<='0');
			WHEN 1E3 => CLKBUS<=(4<='1',OTHERS<='0');
			WHEN 1E4 => CLKBUS<=(3<='1',OTHERS<='0');
			WHEN 1E5 => CLKBUS<=(2<='1',OTHERS<='0');
			WHEN 1E6 => CLKBUS<=(1<='1',OTHERS<='0');
			WHEN 1E7 => CLKBUS<=(0<='1',OTHERS<='0');
			WHEN 1E8 => CLKBUS<=(1<='1',OTHERS<='0');
END behav;